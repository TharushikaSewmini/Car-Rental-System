<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer DashBoard</title>

    <link rel="icon" href="assets/images/logo.png">
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/css/all.min.css">

    <link href="assets/styles/CustomerDashBoardForm.css" rel="stylesheet">
</head>
<body>
<!--Nav Bar-->
<nav class="navbar navbar-expand-lg bg-light" id="navbar">
    <div class="container-fluid">
        <img src="assets/images/logo.png" alt="Logo" width="80" height="60" class="d-inline-block align-text-top">
        <a class="navbar-brand" href="#">Easy Car Rental</a>
        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item ms-3">
                    <a class="nav-link active" aria-current="page" href="#" id="linkProfile">DashBoard</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link active" href="#" id="linkBookingRequest">Booking Request</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link active" href="#" id="linkBookingResponse">Booking Response</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link active" href="#" id="linkPayment">Payment</a>
                </li>
            </ul>

            <!--navbar sign up,log out-->
            <ul class="navbar-nav me-6 mb-2 mb-lg-0" id="navbarSideContent" style="color: #1D314F;">
                <li class="nav-item me-4">
                    <i class="fa-solid fa-user"></i>
                    <a class="nav-link" href="#" style="padding-left: 0; display: inline-block; font-weight: bold; color: #1D314F;">Sign Up</a>
                </li>

                <li class="nav-item">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <a class="nav-link" href="#" style="padding-left: 0; display: inline-block; font-weight: bold; color: #1D314F;">Log Out</a>
                </li>

            </ul>
        </div>
    </div>
</nav>

<main class="container-fluid">
    <!----------Page Header---------->
    <section class="container" id="customerProfilePage">
        <h1 class="mt-3" style="text-align: center">Your Profile</h1>

        <!----------Customer Form-------->
        <form class="row g-3 mt-4" id="customerForm">
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerName" class="form-label">Name</label>
                <input type="text" class="form-control" id="txtLoadCustomerName" name="lName">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerAddress" class="form-label">Address</label>
                <input type="text" class="form-control" id="txtLoadCustomerAddress" name="lAddress">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerContact" class="form-label">Contact No</label>
                <input type="text" class="form-control" id="txtLoadCustomerContact" name="lContact">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerEmail" class="form-label">Email</label>
                <input type="text" class="form-control" id="txtLoadCustomerEmail" name="lEmail">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerNIC" class="form-label">NIC</label>
                <input type="text" class="form-control" id="txtLoadCustomerNIC" name="lNic">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerDrivingLicenseNo" class="form-label">Driving License No</label>
                <input type="text" class="form-control" id="txtLoadCustomerDrivingLicenseNo" name="lDrivingLicenseNo">
            </div>
            <div class="col-md-3 mt-3">
                <label for="txtLoadCustomerUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="txtLoadCustomerUsername" name="lUsername">
            </div>
            <div class="col-md-4 mt-3">
                <label for="txtLoadCustomerPassword" class="form-label">Current Password</label>
                <input type="text" class="form-control" id="txtLoadCustomerPassword" name="lPassword">
            </div>
            <div class="col-md-4 mt-3">
                <label for="txtCustomerNewPassword" class="form-label">New Password</label>
                <input type="text" class="form-control" id="txtCustomerNewPassword" name="lNewPassword">
            </div>
            <div class="col-md-4 mt-3">
                <label for="txtConfirmCustomerPassword" class="form-label">Confirm Password</label>
                <input type="text" class="form-control" id="txtConfirmCustomerPassword" name="lConfirmPassword">
            </div>
            <div class="col-6 mx-auto mt-5">
                <button type="button" class="btn btn-primary col-3 mx-5" id="btnUpdateCustomer">Save Changes</button>
                <button type="button" class="btn btn-danger col-3 mx-5" id="btnCancelCustomer">Cancel</button>
            </div>
        </form>


<!--        &lt;!&ndash;-&#45;&#45;&#45;&#45;Customer Table-&#45;&#45;&#45;&#45;&ndash;&gt;-->
<!--        <section class="mt-4">-->
<!--            <table class="table table-striped">-->
<!--                <thead>-->
<!--                <tr>-->
<!--                    <th scope="col">Customer ID</th>-->
<!--                    <th scope="col">Name</th>-->
<!--                    <th scope="col">Contact No</th>-->
<!--                    <th scope="col">Address</th>-->
<!--                    <th scope="col">Email</th>-->
<!--                    <th scope="col">NIC</th>-->
<!--                    <th scope="col">Driving License No</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody id="tblCustomer">-->
<!--                <tr></tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </section>-->
    </section>

    <!--Rent Request Page-->
    <section class="container" id="bookingRequestPage">
        <h1 class="mt-3" style="text-align: center">Booking Request</h1>

        <!----------Rent Request Form-------->
        <form class="row g-3 mt-2" id="carForm">
            <div class="col-md-3 mt-3">
                <label for="selectType" class="form-label">Type</label>
                <select id="selectType" class="form-select" name="selectType">
                    <option selected hidden>Choose...</option>
                    <option>General</option>
                    <option>Premium</option>
                    <option>Luxury</option>
                </select>
            </div>

            <div class="col-md-3">
                <label for="selectBrand" class="form-label">Brand</label>
                <select id="selectBrand" class="form-select" name="loadBrand">
                    <option selected hidden>Choose...</option>
                </select>
            </div>

            <div class="col-md-3 mt-3">
                <label for="selectCarRegNo" class="form-label">Registration No</label>
                <select id="selectCarRegNo" class="form-select" name="selectRegNo">
                    <option selected hidden>Choose...</option>
                </select>
            </div>

<!--            <div class="col-md-3">-->
<!--                <label for="txtLoadBrand" class="form-label">Brand</label>-->
<!--                <input type="text" class="form-control" id="txtLoadBrand" readonly name="loadBrand">-->
<!--            </div>-->

            <div class="col-3">
                <label for="txtLoadNoOfPassengers" class="form-label">No of Passengers</label>
                <input type="text" class="form-control" id="txtLoadNoOfPassengers" readonly name="loadNoOfPassengers">
            </div>

            <div class="col-3 mt-3">
                <label for="loadColor" class="form-label">Color</label>
                <input type="color" class="form-control" id="loadColor" disabled readonly name="loadColor">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadTransmissionType" class="form-label">Transmission Type</label>
                <input type="text" class="form-control" id="txtLoadTransmissionType" readonly name="loadTransmissionType">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadFuelType" class="form-label">Fuel Type</label>
                <input type="text" class="form-control" id="txtLoadFuelType" readonly name="loadFuelType">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadDailyRate" class="form-label">Daily Rate(Rs)</label>
                <input type="text" class="form-control" id="txtLoadDailyRate" readonly name="loadDailyRate">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadMonthlyRate" class="form-label">Monthly Rate(Rs)</label>
                <input type="text" class="form-control" id="txtLoadMonthlyRate" readonly name="loadMonthlyRate">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadLossDamageWaiver" class="form-label">Loss Damage Waiver(Rs)</label>
                <input type="text" class="form-control" id="txtLoadLossDamageWaiver" readonly name="loadLossDamageWaiver">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadFreeKMForDay" class="form-label">Free KM for Day</label>
                <input type="text" class="form-control" id="txtLoadFreeKMForDay" readonly name="loadFreeKMForDay">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadFreeKMForMonth" class="form-label">Free KM for Month</label>
                <input type="text" class="form-control" id="txtLoadFreeKMForMonth" readonly name="loadFreeKMForMonth">
            </div>

            <div class="col-md-3 mt-3">
                <label for="txtLoadPriceForExtraKM" class="form-label">Price Per Extra KM(Rs)</label>
                <input type="text" class="form-control" id="txtLoadPriceForExtraKM" readonly name="loadPriceForExtraKM">
            </div>

            <!------Images of Car------->
                <div class="col-md-3 ms-4" style="width: 200px; height: 120px; border: 1px solid black;">
                    <img alt="Image" id="loadCarImage1" src="" style="width: 100%; height: 100%;">
                </div>
                <div class="col-md-3" style="width: 200px; height: 120px; border: 1px solid black;">
                    <img alt="Image" id="loadCarImage2" src="" style="width: 100%; height: 100%;">
                </div>
                <div class="col-md-3" style="width: 200px; height: 120px; border: 1px solid black;">
                    <img alt="Image" id="loadCarImage3" src="" style="width: 100%; height: 100%;">
                </div>
                <div class="col-md-3" style="width: 200px; height: 120px; border: 1px solid black;">
                    <img alt="Image" id="loadCarImage4" src="" style="width: 100%; height: 100%;">
                </div>

            <hr class="hr mx-auto mt-3" />

            <div class="col-md-3">
                <label for="txtPickupDate" class="form-label">Choose Pickup Date</label>
                <input type="date" class="form-control" id="txtPickupDate" name="pickupDate">
            </div>

            <div class="col-md-3">
                <label for="txtReturnDate" class="form-label">Choose Return Date</label>
                <input type="date" class="form-control" id="txtReturnDate" name="returnDate">
            </div>

            <div class="col-3">
                <label for="uploadLossDamageWaiverReceipt" class="form-label">Upload Loss Damage Waiver Receipt</label>
                <input class="form-control" type="file" id="uploadLossDamageWaiverReceipt" name="lossDamageWaiver">
            </div>

            <div class="col-md-3 mt-3">
                <label for="selectedDriverOption" class="form-label">Need a Driver?</label>
                <select id="selectedDriverOption" class="form-select" name="driverOption">
                    <option selected hidden>Choose...</option>
                    <option>Yes</option>
                    <option>No</option>
                </select>
            </div>

            <div class="col-md-5 mt-4 mx-auto">
                <button type="button" class="btn btn-primary" id="btnSendRequest">Send Booking Request</button>
                <button type="button" class="btn btn-danger ms-5 px-4" id="btnCancelRequest">Cancel</button>
            </div>
        </form>

        <!--Rent Request Table-->
        <section class="mt-4">
            <table class="table table-striped">
                <thead style="background-color: #8E44AD; color: white;">
                <tr>
                    <th scope="col">Reg No</th>
                    <th scope="col">Brand</th>
                    <th scope="col">Type</th>
                    <th scope="col">Color</th>
                    <th scope="col">No of Passengers</th>
                    <th scope="col">Transmission Type</th>
                    <th scope="col">Fuel Type</th>
                    <th scope="col">Daily Rate</th>
                    <th scope="col">Monthly Rate</th>
                    <th scope="col">Loss Damage Waiver</th>
                    <th scope="col">Free KM for a Day</th>
                    <th scope="col">Free KM for a Month</th>
                    <th scope="col">Price for Extra KM</th>
                    <th scope="col">PickupDate</th>
                    <th scope="col">ReturnDate</th>
                    <th scope="col">Need Driver</th>
                </tr>
                </thead>
                <tbody id="tblRentRequest">
                <tr></tr>
                </tbody>
            </table>
        </section>

    </section>

    <!--Rent Response Page-->
    <section class="container-fluid" id="bookingResponsePage">
        <h1 class="mt-3" style="text-align: center">Booking Response</h1>

        <section class="d-flex justify-content-evenly">
            <!--Rent Response Table-->
            <section class="mt-4 col-7">
                <table class="table table-striped">
                    <thead style="background-color: #8E44AD; color: white;">
                    <tr>
                        <th scope="col">Booking ID</th>
                        <th scope="col">Booking Date</th>
                        <th scope="col">Car RegNo</th>
                        <th scope="col">Brand</th>
                        <th scope="col">Driver ID</th>
                        <th scope="col">Pickup Date</th>
                        <th scope="col">Return Date</th>
                        <th scope="col">Status</th>
                    </tr>
                    </thead>
                    <tbody id="tblRentResponse">
                    <tr></tr>
                    </tbody>
                </table>
            </section>

            <!--Customer Booking Response Form-->
            <div class="col-4 mt-1 px-0 ms-5" style="display: inline-block;">
                <form class="row g-3" id="bookingResponseForm">
                    <div class="col-md-6">
                        <label for="txtViewBookingRequestId" class="form-label my-1">Booking ID</label>
                        <input class="form-control" type="text" id="txtViewBookingRequestId" name="viewBookingId" disabled>
                    </div>
                    <div class="col-md-6">
                        <label for="txtViewBookingDate" class="form-label my-1">Booking Date</label>
                        <input type="text" class="form-control" id="txtViewBookingDate" name="viewBookingDate" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewCarRegNo" class="form-label my-1">Car Reg No</label>
                        <input type="text" class="form-control" id="txtViewCarRegNo" name="viewCarRegNo" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewBrand" class="form-label my-1">Brand</label>
                        <input type="text" class="form-control" id="txtViewBrand" name="viewCarBrand" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewPickupDate" class="form-label my-1">Pickup Date</label>
                        <input type="date" class="form-control" id="txtViewPickupDate" name="viewPickupDate" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewReturnDate" class="form-label my-1">Return Date</label>
                        <input type="date" class="form-control" id="txtViewReturnDate" name="viewReturnDate" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewDriverId" class="form-label my-1">Driver ID</label>
                        <input type="text" class="form-control" id="txtViewDriverId" name="viewDriverId" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewDriverName" class="form-label my-1">Driver Name</label>
                        <input type="text" class="form-control" id="txtViewDriverName" name="viewDriverName" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewDriverContact" class="form-label my-1">Driver Contact</label>
                        <input type="text" class="form-control" id="txtViewDriverContact" name="viewDriverContact" disabled>
                    </div>
                    <div class="col-md-6 my-1">
                        <label for="txtViewBookingStatus" class="form-label my-1">Status</label>
                        <input type="text" class="form-control" id="txtViewBookingStatus" name="viewBookingStatus" disabled>
                    </div>

                    <div class="col-md-8 my-1">
                        <label for="txtViewDenialReason" class="form-label my-1">Denial Reason</label>
                        <input type="text" class="form-control" id="txtViewDenialReason" name="viewDenialReason" disabled>
                    </div>

                    <div class="col-12 mx-auto px-auto d-flex justify-content-center">
<!--                        <button type="button" class="btn btn-success col-md-5" id="btnPaidForCar">Paid for Car</button>-->
                        <button type="button" class="btn btn-danger col-md-5 mx-4" id="btnCancelBooking">Cancel Booking</button>
                    </div>
                </form>
            </div>

        </section>
    </section>

    <!--Payment Page-->
    <section class="container" id="paymentPage">
        <h1 class="mt-3" style="text-align: center">Payment</h1>

        <!--Payment Table-->
        <section class="mt-4">
            <table class="table table-striped">
                <thead style="background-color: #8E44AD; color: white;">
                <tr>
                    <th scope="col">Payment ID</th>
                    <th scope="col">Payment Date</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Booking ID</th>
                </tr>
                </thead>
                <tbody id="tblPayment">
                <tr></tr>
                </tbody>
            </table>
        </section>
    </section>
</main>

<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/CustomerDashBoard.js"></script>
<script>

    let baseURL = "http://localhost:8080/EasyCarRentalApp/";


    let username = localStorage.getItem("Username");
    let password = localStorage.getItem("Password");
    getLastLoginCustomer();

//=====================Customer Profile================

    //------Set Data InputFields-----------
    function setCustomerDetailsTextFieldValues(lName, lAddress, lContact, lEmail, lNic, lDrivingLicenseNo, lUsername, lPassword){
        $("#txtLoadCustomerName").val(lName);
        $("#txtLoadCustomerAddress").val(lAddress);
        $("#txtLoadCustomerContact").val(lContact);
        $("#txtLoadCustomerEmail").val(lEmail);
        $("#txtLoadCustomerNIC").val(lNic);
        $("#txtLoadCustomerDrivingLicenseNo").val(lDrivingLicenseNo);
        $("#txtLoadCustomerUsername").val(lUsername);
        $("#txtLoadCustomerPassword").val(lPassword);
    }

    //----------------Get Customer by Username--------------
    function getLastLoginCustomer() {
        let typedUsername = username;

        let typedPassword = password;
        // console.log("lastLog: "+typedUsername);
        $.ajax({
            url: baseURL+"customer/username/"+typedUsername+"/password/"+typedPassword,
            method: "get",
            dataType: "json",
            async: false,
            success: function (resp){
                // alert(resp.message);
                console.log(resp.data);
                var customer = resp.data;
                // alert(customer);

                $.ajax ({
                    url: baseURL+"booking?email="+customer.email,
                    dataType: "json",
                    contentType: "application/json",
                    success: function (resp) {
                        let booking = resp.data;
                        console.log("Data: "+resp.data);

                        for (let i in booking) {
                            // if (booking[i] !== null) {
                                let status = booking[i].status;
                            console.log("SS: "+status);

                            if (status === "Accepted"){
                                $("#customerForm>div>input").prop("readonly", true);
                                $("#txtLoadCustomerContact").prop("readonly", false);
                            }else {
                                setCustomerDetailsTextFieldValues(customer.name, customer.address, customer.contact, customer.email,
                                    customer.nic, customer.drivingLicenseNo, customer.username, customer.password);
                            }
                        }

                    }
                });
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
            }
        });
    }

    //----------------Update Customer Profile--------------
    $("#btnUpdateCustomer").click(function (){
        let name = $("#txtLoadCustomerName").val();
        let address = $("#txtLoadCustomerAddress").val();
        let contact =  $("#txtLoadCustomerContact").val();
        let email = $("#txtLoadCustomerEmail").val();
        let nic = $("#txtLoadCustomerNIC").val();
        let drivingLicenseNo = $("#txtLoadCustomerDrivingLicenseNo").val();
        let username = $("#txtLoadCustomerUsername").val();
        // let password = $("#txtLoadCustomerPassword").val();
        let newPassword = $("#txtCustomerNewPassword").val();
        let confirmedPassword = $("#txtConfirmCustomerPassword").val();

        // if ($("#txtCustomerNewPassword").val() instanceof $("#txtConfirmCustomerPassword").val()){
        //     alert("Password and Confirm Password does not match");
        // }

        var customer= {
            name: name,
            address: address,
            contact: contact,
            email: email,
            nic: nic,
            drivingLicenseNo: drivingLicenseNo,
            username: username,
            password: confirmedPassword
        }

        $.ajax({
            url: baseURL+"customer",
            method: "put",
            contentType: "application/json",
            data: JSON.stringify(customer),
            dataType: "json",
            async: false,
            success: function (resp){
                alert(resp.message);
            },
            error: function (error){
                var jsObject = JSON.parse(error.responseText).message;
                alert(jsObject.message);
            }
        });
    });


//==========================Car Booking Request===============

    //----------------Get Cars by Type--------------
    $("#selectType").change(function (){
        // getAllCarByTypeAndStatus();
        getAllCarBrandsByType();
    });

    // function getAllCarByTypeAndStatus() {
    //     $("#selectCarRegNo").empty();
    //     let selectedType = $("#selectType").val();
    //     $.ajax({
    //         url: baseURL+"car?type="+selectedType+"&status=Available",
    //         method: "get",
    //         dataType: "json",
    //         success: function (resp){
    //             // alert(resp.message);
    //             console.log(resp.data);
    //             $("#selectCarRegNo").append(`<option hidden>Choose..</option>`);
    //             for (let car of resp.data) {
    //                 let regNo = car.regNo;
    //                 $("#selectCarRegNo").append(`<option value="${regNo}">${regNo}</option>`);
    //             }
    //         },
    //         error: function (error){
    //             alert(JSON.parse(error.responseText).message);
    //         }
    //     });
    // }

    function getAllCarBrandsByType() {
        $("#selectBrand").empty();
        let selectedType = $("#selectType").val();
        $.ajax({
            url: baseURL+"car?type="+selectedType+"",
            method: "get",
            dataType: "json",
            success: function (resp){
                // alert(resp.message);
                console.log(resp.data);
                $("#selectBrand").append(`<option hidden>Choose..</option>`);
                for (let car of resp.data) {
                    let brand = car.brand;
                    console.log(brand);
                    $("#selectBrand").append(`<option value="${brand}">${brand}</option>`);
                }
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
            }
        });
    }

    //----------------Get Cars by Brand--------------
    $("#selectBrand").change(function (){
        // getAllCarByTypeAndStatus();
        getAllCarsByBrand();
    });

    function getAllCarsByBrand() {
        $("#selectCarRegNo").empty();
        let selectedBrand = $("#selectBrand").val();
        console.log("S: "+selectedBrand);
        $.ajax({
            url: baseURL+"car?brand="+selectedBrand+"",
            method: "get",
            dataType: "json",
            success: function (resp){
                // alert(resp.message);
                console.log(resp.data);
                $("#selectCarRegNo").append(`<option hidden>Choose..</option>`);
                for (let car of resp.data) {
                    let regNo = car.regNo;
                    $("#selectCarRegNo").append(`<option value="${regNo}">${regNo}</option>`);
                }
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
            }
        });
    }

    // $("#selectType").change(function (){
    //     $("#selectCarRegNo").empty();
    //     let type = $("#selectType").val();
    //     let res = searchRegNoByType(type);
    //     // console.log(res);
    //     for (let car of res) {
    //         let regNo = car.regNo;
    //         $("#selectCarRegNo").append(`<option value="${regNo}">${regNo}</option>`);
    //     }
    // });

    // function searchRegNoByType(type){
    //     let response = ""
    //     let selectedType = $("#selectType").val();
    //     $.ajax({
    //         url: baseURL+"car?type="+selectedType+"",
    //         method: "get",
    //         dataType: "json",
    //         async: false,
    //         success: function (resp){
    //             alert(resp.message);
    //             console.log(resp.data);
    //             response = resp.data.filter((i) => {
    //                 return i.type == type;
    //             });
    //         }
    //     });
    //     console.log("1: "+response);
    //     return response;
    // }

    //----------------Clear InputFields--------------
    function setCarDetailsFormTextFieldValues(loadColor,loadNoOfPassengers,loadTransmissionType,loadFuelType,loadDailyRate,loadMonthlyRate,loadLossDamageWaiver,
                                              loadFreeKMForDay,loadFreeKMForMonth,loadPriceForExtraKM,pickupDate,returnDate,uploadLossDamageWaiver,driverOption){
        // $("#txtLoadBrand").val(loadBrand);
        $("#loadColor").val(loadColor);
        $("#txtLoadNoOfPassengers").val(loadNoOfPassengers);
        $("#txtLoadTransmissionType").val(loadTransmissionType);
        $("#txtLoadFuelType").val(loadFuelType);
        $("#txtLoadDailyRate").val(loadDailyRate);
        $("#txtLoadMonthlyRate").val(loadMonthlyRate);
        $("#txtLoadLossDamageWaiver").val(loadLossDamageWaiver);
        $("#txtLoadFreeKMForDay").val(loadFreeKMForDay);
        $("#txtLoadFreeKMForMonth").val(loadFreeKMForMonth);
        $("#txtLoadPriceForExtraKM").val(loadPriceForExtraKM);
        $("#txtPickupDate").val(pickupDate);
        $("#txtReturnDate").val(returnDate);
        $("#uploadLossDamageWaiverReceipt").val(uploadLossDamageWaiver);
        $("#selectedDriverOption").val(driverOption);
    }

    //--------------Get Car Details by RegNo----------
    $("#selectCarRegNo").change(function (){
        getCarByRegNo();
    });

    function getCarByRegNo(){
        // $("#selectCarRegNo").empty();
        let selectedRegNo = $("#selectCarRegNo").val();
        imageLoad(selectedRegNo);
        $.ajax({
            url: baseURL+"car/search/"+selectedRegNo,
            method: "get",
            dataType: "json",
            success: function (resp){
                // alert(resp.message);
                console.log("Resp.data"+resp.data);
                let car = resp.data;
                setCarDetailsFormTextFieldValues(car.color, car.noOfPassengers, car.transmissionType, car.fuelType,
                    car.dailyRate, car.monthlyRate, car.lossDamageWaiver, car.freeKMForDay, car.freeKMForMonth, car.priceForExtraKM);
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
            }
        });
    }

    function imageLoad(carregNo) {
        var carRegNo = carregNo;
        console.log("Image"+carRegNo);
        $.ajax({
            url: baseURL + "car?regNo="+carRegNo+"",
            method: 'get',
            success: function (resp) {
                console.log(resp.data);
                url1 = resp.data[0];
                url2 = resp.data[1];
                url3 = resp.data[2];
                url4 = resp.data[3];

                console.log("image1:"+url1);
                console.log("image2:"+url2);
                console.log("image3:"+url3);
                console.log("image4:"+url4);

                $("#loadCarImage1").attr("src", baseURL + url1);
                $("#loadCarImage2").attr("src", baseURL + url2);
                $("#loadCarImage3").attr("src", baseURL + url3);
                $("#loadCarImage4").attr("src", baseURL + url4);

                console.log("ii: "+baseURL+url1);
            },
            error: function (err) {
                console.log(err);
            }
        });
    }

    //----------------Get Current Date--------------
    function getCurrentDate(){
        const date = new Date();
        let day = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();

        if (day < 10) day = '0' + day;
        if (month < 10) month = '0' + month;

        return `${year}-${month}-${day}`;
    }

    //----------------Add Booking Request--------------
    function addBookingRequest(){
        let carRegNo= $("#selectCarRegNo").val();

        let bookingDate = getCurrentDate();
        // var carBrand = $("#txtLoadBrand").val();
        let customerEmail = $("#txtLoadCustomerEmail").val();
        let driverOption = $("#selectedDriverOption").val();
        let status = "pending";
        let pickupDate = $("#txtPickupDate").val();
        let returnDate = $("#txtReturnDate").val();

        let car;
        let customer;
        let driver;

        $.ajax({
            url: baseURL+"car/search/"+carRegNo,
            method: "get",
            async: true,
            dataType: "json",
            success: function (resp){
                // alert(resp.message);
                console.log(resp.data);
                const data = resp.data;
                console.log(resp.data.regNo);
                car = resp.data;

                $.ajax({
                    url: baseURL+"customer?email="+customerEmail+"",
                    method: "get",
                    dataType: "json",
                    success: function (resp){
                        // alert(resp.message);
                        console.log(resp.data);
                        customer = resp.data;

                        if ($("#selectedDriverOption").val() !== "No" ){
                            $.ajax({
                                url: baseURL+"driver?driverStatus=Available",
                                method: "get",
                                dataType: "json",
                                success: function (resp){
                                    // alert(resp.message);
                                    console.log(resp.data);
                                    driver = resp.data;

                                    console.log("Printed: "+car.regNo+" "+customer.email+" "+driver.driverId);
                                    $.ajax({
                                        url: baseURL + "booking",
                                        method: 'post',
                                        contentType: "application/json",
                                        async: true,
                                        data: JSON.stringify(
                                            {
                                                bookingDate: bookingDate,
                                                pickupDate: pickupDate,
                                                returnDate: returnDate,
                                                status: status,
                                                car: car,
                                                customer: customer,
                                                driver: driver[0]
                                            }
                                        ),
                                        success: function (resp) {
                                            console.log(resp)
                                            alert("Successfully Car Booked");

                                            //Load Customer Booking Response Table
                                            loadAllBookingRequestsOfCustomer();

                                            //Load Admin Booking Request Table
                                            // loadAllPendingBookingRequests();

                                            setCarDetailsFormTextFieldValues("");
                                            $("#selectType").val("");
                                            $("#selectBrand").val("");
                                            $("#selectCarRegNo").val("");
                                        },
                                        error: function (err) {
                                            console.log(err);
                                        }
                                    });
                                }
                            });
                        }else {
                            $.ajax({
                                url: baseURL+"driver?driverId=NoDriver",
                                method: "get",
                                dataType: "json",
                                success: function (resp){
                                    // alert(resp.message);
                                    console.log(resp.data);
                                    driver = resp.data;

                                    console.log("Printed: "+car+" "+customer+" "+driver);
                                    $.ajax({
                                        url: baseURL + "booking",
                                        method: 'post',
                                        contentType: "application/json",
                                        data: JSON.stringify(
                                            {
                                                bookingDate: bookingDate,
                                                pickupDate: pickupDate,
                                                returnDate: returnDate,
                                                status: status,
                                                car: car,
                                                customer: customer,
                                                driver: driver
                                            }
                                        ),
                                        success: function (resp) {
                                            console.log(resp)
                                            alert("Successfully Car Booked");
                                            //Load Customer Booking Response Table
                                            loadAllBookingRequestsOfCustomer();

                                            //Load Admin Booking Request Table
                                            // loadAllPendingBookingRequests();

                                            setCarDetailsFormTextFieldValues("");
                                            $("#selectType").val("");
                                            $("#selectBrand").val("");
                                            $("#selectCarRegNo").val("");
                                        },
                                        error: function (err) {
                                            console.log(err);
                                        }
                                    });
                                }
                            });
                        }
                    }
                });
            }
        });
    }

    //----------------Upload Loss Damage Waiver Receipt--------------
    function uploadLossDamageWaiverReceipt(){
        var fileObject = $("#uploadLossDamageWaiverReceipt")[0].files[0];//access file object from input field
        var fileName = $('#uploadLossDamageWaiverReceipt').val() + " - uploadLossDamageWaiverReceipt";

        console.log(fileName);

        var data = new FormData();
        data.append("uploadLossDamageWaiverReceipt", fileObject, fileName);

        if (fileObject != null) {
            $.ajax({
                url: baseURL + "booking/file",
                method: 'post',
                async: true,
                contentType: false,
                processData: false,
                data: data,
                success: function (resp) {
                    if (resp) {
                        addBookingRequest();
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }else {
            alert("Loss Damage Waiver Receipt does not uploaded");
        }
    }

    //----------------Send Booking Request--------------
    $("#btnSendRequest").click(function (){
        uploadLossDamageWaiverReceipt();
        // loadAllBookingRequestsOfCustomer();
    });

    //----------------Cancel Booking Request--------------
    $("#btnCancelRequest").click(function (){
        setCarDetailsFormTextFieldValues("");
        $("#selectType").val("");
        $("#selectBrand").val("");
        $("#selectCarRegNo").val("");
    });

    //==========================Your Booking Requests===============

    loadAllBookingRequestsOfCustomer();


    function loadAllBookingRequestsOfCustomer(){
        $("#tblRentResponse").empty();

        let customerEmail = $("#txtLoadCustomerEmail").val();
        console.log("Email: "+customerEmail);
        $.ajax ({
            url: baseURL+"booking/email/"+customerEmail,
            dataType: "json",
            // contentType: "application/json",
            success: function (resp) {
                // console.log(resp);
                // for (let booking of resp.data) {
                //     var row = '<tr><td>'+booking.bookingId+'</td><td>'+booking.bookingDate+'</td><td>'+booking.customerName+'</td><td>'+booking.customerEmail+'</td><td>'
                //         +booking.carRegNo+'</td><td>'+booking.driverId+'</td>' +'<td>'+booking.pickupDate+'</td><td>'+booking.returnDate+'</td><td>'+booking.status+'</td></tr>';
                //     $("#tblBookingRequest").append(row);
                // }

                let bookingRequests = resp.data;
                console.log("Req:"+bookingRequests);
                for (let i in bookingRequests) {
                    let rentId = bookingRequests[i].bookingId;
                    let rentDate = bookingRequests[i].bookingDate;
                    let carId = bookingRequests[i].car.regNo;
                    let brand = bookingRequests[i].car.brand;
                    let driver;
                    let start = bookingRequests[i].pickupDate;
                    let end = bookingRequests[i].returnDate;
                    let status = bookingRequests[i].status;

                    if (bookingRequests[i].driver !== null){
                        driver = bookingRequests[i].driver.driverId;
                    }else {
                        driver = "No";
                    }

                    let row = `<tr><td>${rentId}</td><td>${rentDate}</td><td>${carId}</td><td>${brand}</td><td>${driver}</td><td>${start}</td><td>${end}</td><td>${splitBookingStatus(status)}</td></tr>`;
                    $('#tblRentResponse').append(row);

                    splitBookingDenialReason(status);
                }

                bindCustomerBookingRequestTableRowClickEvents();
                setBookingResponseFormTextFieldValues("","","","");
                // $("#selectAnotherDriver").focus();
            },
            error: function (error){
                var jsObject = JSON.parse(error.responseText).message;
                alert(jsObject.message);
            }
        });
    }

    function splitBookingStatus(status){
        let denialReason;
        let splitStatus;
        if (status !== "Accepted" && status !== "pending") {
            console.log("STATUS1: "+status);
            denialReason = status.split(": ");
            splitStatus = denialReason[0];
            console.log("status: "+splitStatus);
            return splitStatus;
        }else {
            return status;
        }
    }

    function splitBookingDenialReason(status){
        let denialReason;
        let splitReason;
        if (status !== "Accepted" && status !== "pending") {
            console.log("STATUS2: "+status);
            denialReason = status.split(": ");
            splitReason = denialReason[1];
            console.log("reason: "+splitReason);
            return splitReason;
        }else {
            return "";
        }
    }

    //----------------Bind Data to InputFields--------------
    function bindCustomerBookingRequestTableRowClickEvents() {
        $("#tblRentResponse>tr").click(function () {
            let bookingId = $(this).children(":eq(0)").text();
            let bookingDate = $(this).children(":eq(1)").text();
            let carRegNo = $(this).children(":eq(2)").text();
            let carBrand = $(this).children(":eq(3)").text();
            let driverId = $(this).children(":eq(4)").text();
            let pickupDate = $(this).children(":eq(5)").text();
            let returnDate = $(this).children(":eq(6)").text();
            let bookingStatus = $(this).children(":eq(7)").text();

            $("#txtViewBookingRequestId").val(bookingId);
            $("#txtViewBookingDate").val(bookingDate);
            $("#txtViewCarRegNo").val(carRegNo);
            $("#txtViewBrand").val(carBrand);
            $("#txtViewDriverId").val(driverId);
            $("#txtViewPickupDate").val(pickupDate);
            $("#txtViewReturnDate").val(returnDate);
            $("#txtViewBookingStatus").val(bookingStatus);

            //Get Denial Reason of Booking
            $.ajax ({
                url: baseURL+"booking?bookingId="+bookingId,
                dataType: "json",
                contentType: "application/json",
                success: function (resp) {
                    console.log("Data: " + resp.data)
                    let booking = resp.data;
                    let getBooking = booking.status;
                    console.log("Bo: " + getBooking)
                    $("#txtViewDenialReason").val(splitBookingDenialReason(getBooking));
                }
            });

            //Get Driver Details
            if (driverId !== "No") {
                $.ajax({
                    url: baseURL + "driver?driverId=" + driverId,
                    dataType: "json",
                    contentType: "application/json",
                    success: function (resp) {
                        let driver = resp.data;
                        let driverName = driver.driverName;
                        let driverContact = driver.driverContact;

                        $("#txtViewDriverName").val(driverName);
                        $("#txtViewDriverContact").val(driverContact);
                    }
                });
            }else {
                $("#txtViewDriverName").val("-");
                $("#txtViewDriverContact").val("-");
            }

        });
    }

    //----------------Clear InputFields--------------
    function setBookingResponseFormTextFieldValues(bookingId,bookingDate,carRegNo,carBrand,driverId,driverName,driverContact,pickupDate,returnDate,bookingStatus,denialReason){
        $("#txtViewBookingRequestId").val(bookingId);
        $("#txtViewBookingDate").val(bookingDate);
        $("#txtViewCarRegNo").val(carRegNo);
        $("#txtViewBrand").val(carBrand);
        $("#txtViewDriverId").val(driverId);
        $("#txtViewDriverName").val(driverName);
        $("#txtViewDriverContact").val(driverContact);
        $("#txtViewPickupDate").val(pickupDate);
        $("#txtViewReturnDate").val(returnDate);
        $("#txtViewBookingStatus").val(bookingStatus);
        $("#txtViewDenialReason").val(denialReason);
    }

    //----------------Cancel Booking--------------
    $("#btnCancelBooking").click(function (){
        let bookingId = $("#txtViewBookingRequestId").val();
        let bookingDate = $("#txtViewBookingDate").val();
        let carRegNo = $("#txtViewCarRegNo").val();
        let carBrand = $("#txtViewBrand").val();
        let driverId = $("#txtViewDriverId").val();
        let driverName = $("#txtViewDriverName").val();
        let driverContact = $("#txtViewDriverContact").val();
        let pickupDate = $("#txtViewPickupDate").val();
        let returnDate = $("#txtViewReturnDate").val();

        // if ($("#selectAnotherDriver").val() !== null){
        //     driverId = $("#selectAnotherDriver").val();
        // }else {
        //     driverId = $("#txtLoadDriverId").val();
        // }

        let customerEmail = $("#txtLoadCustomerEmail").val();

        let status = $("#txtViewBookingStatus").val();

        let car;
        let customer;
        let driver;

        if (status === "Accepted" || status === "pending"){
            $.ajax({
                url: baseURL+"car/search/"+carRegNo,
                method: "get",
                async: true,
                dataType: "json",
                success: function (resp){
                    // alert(resp.message);
                    console.log(resp.data);
                    const data = resp.data;
                    console.log(resp.data.regNo);
                    car = resp.data;

                    $.ajax({
                        url: baseURL+"customer?email="+customerEmail+"",
                        method: "get",
                        dataType: "json",
                        success: function (resp){
                            // alert(resp.message);
                            console.log(resp.data);
                            customer = resp.data;

                            $.ajax({
                                url: baseURL+"driver?driverId="+driverId,
                                method: "get",
                                dataType: "json",
                                success: function (resp){
                                    // alert(resp.message);
                                    console.log(resp.data);
                                    driver = resp.data;

                                    $.ajax({
                                        url: baseURL+"booking",
                                        method: "put",
                                        contentType: "application/json",
                                        data: JSON.stringify(
                                            {
                                                bookingId: parseInt(bookingId),
                                                bookingDate: bookingDate,
                                                pickupDate: pickupDate,
                                                returnDate: returnDate,
                                                status: "Canceled By Customer",
                                                car: car,
                                                customer: customer,
                                                driver: driver
                                            }
                                        ),
                                        success: function (resp){

                                            // let booking = bookingId;
                                            // console.log("B: "+resp.data);
                                            if (status !== "pending"){
                                                //Update Car Status
                                                $.ajax({
                                                    url: baseURL + "car",
                                                    method: "put",
                                                    contentType: "application/json",
                                                    async: false,
                                                    data: JSON.stringify(
                                                        {
                                                            regNo: car.regNo,
                                                            brand: car.brand,
                                                            type: car.type,
                                                            color: car.color,
                                                            noOfPassengers: car.noOfPassengers,
                                                            transmissionType: car.transmissionType,
                                                            fuelType: car.fuelType,
                                                            dailyRate: car.dailyRate,
                                                            monthlyRate: car.monthlyRate,
                                                            lossDamageWaiver: car.lossDamageWaiver,
                                                            freeKMForDay: car.freeKMForDay,
                                                            freeKMForMonth: car.freeKMForMonth,
                                                            priceForExtraKM: car.priceForExtraKM,
                                                            status: "Available",
                                                            completedKM: car.completedKM
                                                        }
                                                    ),
                                                    dataType: "json",
                                                    success: function (resp) {
                                                        alert(resp.message);

                                                        if (driverId !== "No") {
                                                            //Update Driver Status
                                                            $.ajax({
                                                                url: baseURL + "driver",
                                                                method: "put",
                                                                contentType: "application/json",
                                                                data: JSON.stringify(
                                                                    {
                                                                        driverId: driver.driverId,
                                                                        driverName: driver.driverName,
                                                                        driverContact: driver.driverContact,
                                                                        driverUsername: driver.driverUsername,
                                                                        driverPassword: driver.driverPassword,
                                                                        driverStatus: "Available"
                                                                    }
                                                                ),
                                                                dataType: "json",
                                                                success: function (resp) {
                                                                    console.log(resp);
                                                                },
                                                                error: function (error) {
                                                                    var jsObject = JSON.parse(error.responseText).message;
                                                                    alert(jsObject.message);
                                                                }
                                                            });
                                                        }

                                                    },
                                                    error: function (error) {
                                                        var jsObject = JSON.parse(error.responseText).message;
                                                        alert(jsObject.message);
                                                    }
                                                });
                                            }

                                                alert(resp.message);
                                                alert("Booking is Canceled");

                                                loadAllBookingRequestsOfCustomer();
                                        },
                                        error: function (error){
                                            var jsObject = JSON.parse(error.responseText).message;
                                            alert(jsObject.message);
                                        }
                                    });
                                }
                            });
                        }
                    });
                }
            });
        }else if (status === "Rented") {
            alert("You Can not Cancel this Booking!!");
        }else {
            alert("This Booking is already Canceled!!");
        }
    });

    //==========================Payments===============
    loadAllBookingPaymentsOfCustomer();

    //----------------Load Data to Payment Table--------------
    function loadAllBookingPaymentsOfCustomer(){
        $("#tblPayment").empty();

        let customerEmail = $("#txtLoadCustomerEmail").val();
        console.log("Email: "+customerEmail);
        $.ajax ({
            url: baseURL+"payment/email/"+customerEmail,
            dataType: "json",
            // contentType: "application/json",
            success: function (resp) {
                // console.log(resp);
                // for (let booking of resp.data) {
                //     var row = '<tr><td>'+booking.bookingId+'</td><td>'+booking.bookingDate+'</td><td>'+booking.customerName+'</td><td>'+booking.customerEmail+'</td><td>'
                //         +booking.carRegNo+'</td><td>'+booking.driverId+'</td>' +'<td>'+booking.pickupDate+'</td><td>'+booking.returnDate+'</td><td>'+booking.status+'</td></tr>';
                //     $("#tblBookingRequest").append(row);
                // }

                let payment = resp.data;
                console.log("Req:"+payment);
                for (let i in payment) {
                    let paymentId = payment[i].paymentId;
                    let paymentDate = payment[i].paymentDate;
                    let amount = payment[i].amount;
                    let booking = payment[i].booking.bookingId;

                    let row = `<tr><td>${paymentId}</td><td>${paymentDate}</td><td>${amount}</td><td>${booking}</td></tr>`;
                    $('#tblPayment').append(row);
                }
            },
            error: function (error){
                var jsObject = JSON.parse(error.responseText).message;
                alert(jsObject.message);
            }
        });
    }

</script>
</body>
</html>